# M3: Delivery + Screener

–ú–æ–¥—É–ª—å –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ Telegram, —Å–∫—Ä–∏–Ω–µ—Ä –º–æ–Ω–µ—Ç –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π scheduler –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Scheduler (asyncio loops)
  ‚îÇ
  ‚îú‚îÄ‚îÄ‚ñ∫ analyze_all(15m/1h/4h) ‚îÄ‚îÄ‚ñ∫ Signal ‚îÄ‚îÄ‚ñ∫ notify_signal() ‚îÄ‚îÄ‚ñ∫ Telegram
  ‚îÇ
  ‚îú‚îÄ‚îÄ‚ñ∫ run_screener() ‚îÄ‚îÄ‚ñ∫ Top 10 ‚îÄ‚îÄ‚ñ∫ notify_screener() ‚îÄ‚îÄ‚ñ∫ Telegram
  ‚îÇ
  ‚îî‚îÄ‚îÄ‚ñ∫ check_new_listings() ‚îÄ‚îÄ‚ñ∫ notify_new_listing() ‚îÄ‚îÄ‚ñ∫ Telegram

Telegram Bot (polling)
  ‚îÇ
  ‚îú‚îÄ‚îÄ‚ñ∫ /status    ‚îÄ‚îÄ‚ñ∫ system overview
  ‚îú‚îÄ‚îÄ‚ñ∫ /top N     ‚îÄ‚îÄ‚ñ∫ top signals (24h)
  ‚îú‚îÄ‚îÄ‚ñ∫ /signal    ‚îÄ‚îÄ‚ñ∫ latest signal for symbol
  ‚îú‚îÄ‚îÄ‚ñ∫ /trade     ‚îÄ‚îÄ‚ñ∫ open paper trade
  ‚îú‚îÄ‚îÄ‚ñ∫ /close     ‚îÄ‚îÄ‚ñ∫ close paper trade (P&L)
  ‚îú‚îÄ‚îÄ‚ñ∫ /portfolio ‚îÄ‚îÄ‚ñ∫ open trades + unrealized P&L
  ‚îî‚îÄ‚îÄ‚ñ∫ /settings  ‚îÄ‚îÄ‚ñ∫ min confidence filter
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –§–∞–π–ª | –ú–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|--------|-----------|
| `delivery/formatter.py` | delivery | –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è Telegram |
| `delivery/notifier.py` | delivery | Async –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram |
| `delivery/bot.py` | delivery | Telegram –±–æ—Ç —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ |
| `delivery/cli.py` | delivery | CLI –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –∏ —Ç–µ—Å—Ç-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| `screener/screener.py` | screener | –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–Ω–µ—Ç –ø–æ composite score |
| `screener/listings.py` | screener | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–æ–≤—ã—Ö –ª–∏—Å—Ç–∏–Ω–≥–æ–≤ ByBit |
| `screener/scheduler.py` | screener | –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞, —Å–∫—Ä–∏–Ω–µ—Ä–∞, –ª–∏—Å—Ç–∏–Ω–≥–æ–≤ |
| `screener/cli.py` | screener | CLI –¥–ª—è —Å–∫—Ä–∏–Ω–µ—Ä–∞ –∏ scheduler |

---

## Telegram Bot

### –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start`, `/help` | –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ |
| `/status` | –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã: —Å–∏–º–≤–æ–ª—ã, —Å–≤–µ—á–∏, —Å–∏–≥–Ω–∞–ª—ã –∑–∞ 24h, uptime |
| `/top [N]` | –¢–æ–ø-N —Å–∏–≥–Ω–∞–ª–æ–≤ –∑–∞ 24 —á–∞—Å–∞ (–ø–æ confidence) |
| `/signal SYMBOL` | –ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–≥–Ω–∞–ª –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ |
| `/trade SYMBOL long\|short SIZE` | –û—Ç–∫—Ä—ã—Ç—å paper trade (SIZE –≤ USDT) |
| `/close ID PRICE` | –ó–∞–∫—Ä—ã—Ç—å paper trade, —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å P&L |
| `/portfolio` | –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ trades —Å unrealized P&L |
| `/settings [value]` | –ü–æ–∫–∞–∑–∞—Ç—å/—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å min confidence (0-1) |

### –§–æ—Ä–º–∞—Ç —Å–∏–≥–Ω–∞–ª–∞

```
üü¢ LONG BTCUSDT (1h)

Entry:      70,735.20
Stop Loss:  69,788.30
TP1:        72,155.55
TP2:        73,102.46
TP3:        74,522.81

Confidence: 65%
R:R:        1.5
Position:   20.0% of capital

Reasons: ema_21 > ema_50, macd_bullish, stochrsi_bullish
```

### –ó–∞–ø—É—Å–∫

```bash
make bot
# –∏–ª–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
python -m src.delivery bot
```

### –¢–µ—Å—Ç-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

```bash
make bot-notify
# –∏–ª–∏:
python -m src.delivery notify --symbol BTCUSDT --direction long
```

---

## –°–∫—Ä–∏–Ω–µ—Ä –º–æ–Ω–µ—Ç

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è

Composite score (0-100) –∏–∑ 4 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Å | –õ–æ–≥–∏–∫–∞ |
|-----------|-----|--------|
| Trend (30%) | 30 | EMA21 vs EMA50 (+25), price vs EMA200 (+25) |
| Volume (25%) | 25 | vol_ratio √ó 50, max 100 |
| Volatility (20%) | 20 | ATR% –≤ –∏–¥–µ–∞–ª—å–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ 1-3% = 100 |
| RSI Setup (25%) | 25 | RSI 30-50 = 90, RSI 50-65 = 70, RSI <30 = 60 |

### –§–∏–ª—å—Ç—Ä—ã

- –ú–∏–Ω–∏–º—É–º 50 —Å–≤–µ—á–µ–π (1h) –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- –ú–∏–Ω–∏–º—É–º $1M –æ–±—ä—ë–º–∞ –∑–∞ 24h (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ)

### CLI

```bash
make screener-scan top=10
# –∏–ª–∏:
python -m src.screener scan --top 10 --timeframe 1h
```

–í—ã–≤–æ–¥:
```
  # Symbol       Score Trend     RSI    Vol 24h
----------------------------------------------------
  1 BTCUSDT       82.5 bullish    45    $5.2B
  2 ETHUSDT       76.3 bullish    52    $2.1B
  3 SOLUSDT       71.0 neutral    38    $800M
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–∏—Å—Ç–∏–Ω–≥–æ–≤

–°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ USDT spot –ø–∞—Ä—ã –Ω–∞ ByBit —Å —Ç–∞–±–ª–∏—Ü–µ–π `symbols` –≤ –ë–î. –ù–æ–≤—ã–µ –ø–∞—Ä—ã = –∞–ª–µ—Ä—Ç –≤ Telegram.

```bash
make screener-listings
# –∏–ª–∏:
python -m src.screener listings
```

---

## Scheduler

Asyncio-based scheduler –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é:

| –ó–∞–¥–∞—á–∞ | –ò–Ω—Ç–µ—Ä–≤–∞–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|----------|
| analyze_15m | 15 –º–∏–Ω | –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ 15m |
| analyze_1h | 1 —á–∞—Å | –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ 1h |
| analyze_4h | 4 —á–∞—Å–∞ | –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ 4h |
| screener | 24 —á–∞—Å–∞ | –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–∫—Ä–∏–Ω–µ—Ä, —Ç–æ–ø-10 –≤ Telegram |
| listings | 15 –º–∏–Ω | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –ª–∏—Å—Ç–∏–Ω–≥–æ–≤ |

–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram.

### –ó–∞–ø—É—Å–∫

```bash
make scheduler top=50
# –∏–ª–∏:
python -m src.screener scheduler --top 50
```

---

## Paper Trading

### –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏

–í Telegram: `/trade BTCUSDT long 100`
- –ë–µ—Ä—ë—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π OHLCV —Å–≤–µ—á–∏
- –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ `paper_trades`
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å trade ID

### –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏

–í Telegram: `/close 1 71000`
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç P&L: `pnl = size √ó (exit - entry) / entry` (–¥–ª—è long)
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç P&L%
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ

–í Telegram: `/portfolio`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ trades
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç unrealized P&L –ø–æ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω–µ –∏–∑ –ë–î
- –°—É–º–º–∞—Ä–Ω—ã–π unrealized P&L

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ß–µ—Ä–µ–∑ `.env`:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ (@BotFather) |
| `TELEGRAM_CHAT_ID` | ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |

---

## –¢–µ—Å—Ç—ã

22 unit-—Ç–µ—Å—Ç–∞:

| –ì—Ä—É–ø–ø–∞ | –¢–µ—Å—Ç–æ–≤ | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è |
|--------|--------|----------------|
| TestFormatter | 14 | –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω, –æ–±—ä—ë–º–æ–≤, —Å–∏–≥–Ω–∞–ª–æ–≤, —Å–∫—Ä–∏–Ω–µ—Ä–∞, –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, –ª–∏—Å—Ç–∏–Ω–≥–æ–≤, —Å—Ç–∞—Ç—É—Å–∞ |
| TestScreener | 8 | Composite score, –¥–∏–∞–ø–∞–∑–æ–Ω, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö, uptrend/downtrend, sub-scores, –≤–µ—Å–∞ |

---

## –ß—Ç–æ –µ—â—ë –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- [ ] n8n –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (webhook endpoint –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö workflows)
- [ ] –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞ open trades (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è)
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º—É confidence (–∏–∑ /settings)
- [ ] Inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è trade –ø–æ —Å–∏–≥–Ω–∞–ª—É
- [ ] –†–µ–∂–∏–º ¬´—Ç–æ–ª—å–∫–æ —Å–∏–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã¬ª (confidence >70%)
